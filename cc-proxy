#!/usr/bin/env bash
# Runs mitmproxy with the Claude API logger addon
# Outputs one JSON object per line (jsonl format)

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PORT="${1:-8080}"

cd "$SCRIPT_DIR"
exec uv run mitmdump -q -p "$PORT" -s "$SCRIPT_DIR/src/cc_proxy/json_request_logger.py"
