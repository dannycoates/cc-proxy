#!/usr/bin/env bash
# Runs mitmproxy UI with the SSE content view addon for Claude API responses
#
# Usage: cc-mitm [-s] [port]
#   -s  Include thinking signatures in output (default: excluded)

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

while getopts "s" opt; do
    case $opt in
        s) export CC_PROXY_INCLUDE_SIGNATURE=1 ;;
        *) echo "Usage: $0 [-s] [port]" >&2; exit 1 ;;
    esac
done
shift $((OPTIND - 1))

PORT="${1:-8080}"

cd "$SCRIPT_DIR"
exec uv run mitmproxy -p "$PORT" -s "$SCRIPT_DIR/src/cc_proxy/sse_contentview.py"
